import prettier from "prettier";
import { packageInfo } from "../utils/index.js";
import { NestedText, flattenNestedText } from "./iterable-text-template.js";

export function formatData(content: unknown) {
  return JSON.stringify(content, undefined, 2);
}

export async function formatCode(nestedCode: NestedText) {
  const banner = `
// @generated by
//
//   ██████╗ ██████╗ ███████╗███╗   ██╗ █████╗ ██████╗ ██╗██╗  ██╗██████╗ 
//  ██╔═══██╗██╔══██╗██╔════╝████╗  ██║██╔══██╗██╔══██╗██║██║  ██║╚════██╗
//  ██║   ██║██████╔╝█████╗  ██╔██╗ ██║███████║██████╔╝██║███████║ █████╔╝
//  ██║   ██║██╔═══╝ ██╔══╝  ██║╚██╗██║██╔══██║██╔═══╝ ██║╚════██║██╔═══╝ 
//  ╚██████╔╝██║     ███████╗██║ ╚████║██║  ██║██║     ██║     ██║███████╗
//   ╚═════╝ ╚═╝     ╚══════╝╚═╝  ╚═══╝╚═╝  ╚═╝╚═╝     ╚═╝     ╚═╝╚══════╝
//   v${(packageInfo.version ?? "").padEnd(47, " ")} -- www.OpenApi42.org
`.trim();

  const code = [...flattenNestedText(nestedCode)].join("");
  const formattedCode = await prettier.format(code.toString(), {
    parser: "typescript",
  });

  return `${banner}\n\n${formattedCode}`;
}
